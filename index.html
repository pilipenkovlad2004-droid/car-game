<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Market Rush Drive</title>

<style>
body {
    margin: 0;
    background: #0e0e0e;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

#road {
    width: 320px;
    height: 100vh;
    margin: auto;
    background: #2b2b2b;
    position: relative;
    overflow: hidden;
}

.line {
    position: absolute;
    width: 8px;
    height: 40px;
    background: #f5f5f5;
    left: 156px;
}

#car {
    width: 52px;
    height: 96px;
    background: linear-gradient(#ff3b3b, #b30000);
    position: absolute;
    bottom: 20px;
    left: 134px;
    border-radius: 12px;
}

.enemy {
    width: 52px;
    height: 96px;
    background: linear-gradient(#7a7a7a, #444);
    position: absolute;
    top: -120px;
    border-radius: 12px;
}

#hud {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
}
</style>
</head>

<body>
<div id="road">
    <div id="hud">0</div>
    <div id="car"></div>
</div>

<script>
let road = document.getElementById("road");
let car = document.getElementById("car");
let hud = document.getElementById("hud");

let carX = 134;
let speed = 3;
let score = 0;
let enemies = [];
let lines = [];

function createLine(y) {
    let l = document.createElement("div");
    l.className = "line";
    l.style.top = y + "px";
    road.appendChild(l);
    lines.push(l);
}

for (let i = 0; i < 20; i++) {
    createLine(i * 60);
}

document.addEventListener("click", e => {
    let w = window.innerWidth;
    if (e.clientX < w / 2 && carX > 60) carX -= 80;
    if (e.clientX >= w / 2 && carX < 220) carX += 80;
    car.style.left = carX + "px";
});

function spawnEnemy() {
    let e = document.createElement("div");
    e.className = "enemy";
    e.style.left = Math.random() > 0.5 ? "60px" : "220px";
    road.appendChild(e);
    enemies.push(e);
}

function loop() {
    score++;
    hud.innerText = "–û—á–∫–∏: " + score;

    if (score % 300 === 0) speed += 0.4;
    if (Math.random() < 0.025) spawnEnemy();

    lines.forEach(l => {
        l.style.top = (l.offsetTop + speed) + "px";
        if (l.offsetTop > window.innerHeight) l.style.top = "-40px";
    });

    enemies.forEach((e, i) => {
        e.style.top = (e.offsetTop + speed) + "px";

        if (e.offsetTop > window.innerHeight) {
            e.remove();
            enemies.splice(i, 1);
        }

        if (
            e.offsetTop + 90 > window.innerHeight - 120 &&
            Math.abs(e.offsetLeft - carX) < 50
        ) {
            endGame();
        }
    });

    requestAnimationFrame(loop);
}

function endGame() {
    Telegram.WebApp.sendData(JSON.stringify({ score }));
    alert("üí• –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ!\n–û—á–∫–∏: " + score);
    location.reload();
}

loop();
</script>
</body>
</html>
