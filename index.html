<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Market Rush Drive</title>

<style>
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    background: #0d0d0d;
    overflow: hidden;
    font-family: Arial, sans-serif;
}

/* ===== –ò–ì–†–û–í–û–ô –≠–ö–†–ê–ù ===== */
#game {
    width: 100vw;
    height: 100vh;
    position: relative;
    overflow: hidden;
}

/* ===== –î–û–†–û–ì–ê ===== */
#road {
    width: 70vw;
    max-width: 420px;
    height: 100vh;
    background: linear-gradient(#3a3a3a, #1f1f1f);
    margin: auto;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 40px rgba(0,0,0,0.8);
}

/* ===== –†–ê–ó–ú–ï–¢–ö–ê ===== */
.line {
    position: absolute;
    width: 10px;
    height: 60px;
    background: linear-gradient(#fff, #ccc);
    left: 50%;
    transform: translateX(-50%);
    border-radius: 5px;
    opacity: 0.9;
}

/* ===== –ú–ê–®–ò–ù–ê ===== */
#car {
    width: 60px;
    height: 110px;
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(180deg, #ff5252, #b00000);
    border-radius: 14px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.6);
}

#car::before {
    content: "";
    position: absolute;
    top: 8px;
    left: 8px;
    right: 8px;
    height: 18px;
    background: rgba(255,255,255,0.25);
    border-radius: 10px;
}

/* ===== –í–†–ê–ì–ò ===== */
.enemy {
    width: 60px;
    height: 110px;
    position: absolute;
    top: -140px;
    background: linear-gradient(180deg, #777, #444);
    border-radius: 14px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.6);
}

/* ===== HUD ===== */
#hud {
    position: absolute;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    color: #fff;
    font-size: 20px;
    background: rgba(0,0,0,0.5);
    padding: 6px 14px;
    border-radius: 20px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.6);
}
</style>
</head>

<body>
<div id="game">
    <div id="road">
        <div id="hud">0</div>
        <div id="car"></div>
    </div>
</div>

<script>
let road = document.getElementById("road");
let car = document.getElementById("car");
let hud = document.getElementById("hud");

let lanes = [];
let laneX = [];
let carLane = 1;

let score = 0;
let speed = 4;
let enemies = [];
let lines = [];

/* ===== –ü–û–õ–û–°–´ ===== */
function setupLanes() {
    let w = road.offsetWidth;
    laneX = [
        w * 0.2 - 30,
        w * 0.5 - 30,
        w * 0.8 - 30
    ];
    car.style.left = laneX[carLane] + "px";
}

window.addEventListener("resize", setupLanes);
setupLanes();

/* ===== –†–ê–ó–ú–ï–¢–ö–ê ===== */
for (let i = 0; i < 15; i++) {
    let l = document.createElement("div");
    l.className = "line";
    l.style.top = (i * 80) + "px";
    road.appendChild(l);
    lines.push(l);
}

/* ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï ===== */
document.addEventListener("click", e => {
    if (e.clientX < window.innerWidth / 2 && carLane > 0) carLane--;
    if (e.clientX >= window.innerWidth / 2 && carLane < 2) carLane++;
    car.style.left = laneX[carLane] + "px";
});

/* ===== –í–†–ê–ì–ò ===== */
function spawnEnemy() {
    let e = document.createElement("div");
    e.className = "enemy";
    let lane = Math.floor(Math.random() * 3);
    e.style.left = laneX[lane] + "px";
    road.appendChild(e);
    enemies.push({el: e, lane});
}

/* ===== –¶–ò–ö–õ ===== */
function loop() {
    score++;
    hud.innerText = "–û—á–∫–∏: " + score;

    if (score % 300 === 0) speed += 0.5;
    if (Math.random() < 0.025) spawnEnemy();

    lines.forEach(l => {
        l.style.top = (l.offsetTop + speed) + "px";
        if (l.offsetTop > window.innerHeight) l.style.top = "-60px";
    });

    enemies.forEach((obj, i) => {
        let e = obj.el;
        e.style.top = (e.offsetTop + speed) + "px";

        if (e.offsetTop > window.innerHeight) {
            e.remove();
            enemies.splice(i, 1);
        }

        if (
            e.offsetTop + 100 > window.innerHeight - 140 &&
            obj.lane === carLane
        ) {
            endGame();
        }
    });

    requestAnimationFrame(loop);
}

/* ===== GAME OVER ===== */
function endGame() {
    Telegram.WebApp.sendData(JSON.stringify({ score }));
    alert("üí• –ê–≤–∞—Ä–∏—è!\n–û—á–∫–∏: " + score);
    location.reload();
}

loop();
</script>
</body>
</html>
