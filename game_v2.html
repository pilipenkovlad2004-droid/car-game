<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Car Rush</title>

<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">

<style>
* {
    box-sizing: border-box;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
}

html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at top, #1e3c72, #0f2027);
    overflow: hidden;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
}

#game {
    position: relative;
    width: 100vw;
    height: 100vh;
}

/* ===== –î–û–†–û–ì–ê ===== */
#road {
    position: absolute;
    width: 72%;
    height: 100%;
    left: 14%;
    background: repeating-linear-gradient(
        #2a2a2a 0px,
        #2a2a2a 50px,
        #333 50px,
        #333 100px
    );
    box-shadow: inset 0 0 80px rgba(0,0,0,.85);
}

/* ===== –ú–ê–®–ò–ù–ê ===== */
#car {
    position: absolute;
    width: 64px;
    height: 110px;
    bottom: 28px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(180deg, #ff5252, #b71c1c);
    border-radius: 18px;
    box-shadow:
        0 18px 35px rgba(0,0,0,.75),
        inset 0 0 10px rgba(255,255,255,.25);
    transition: left 0.18s cubic-bezier(.25,.8,.25,1);
}

/* ===== –ü–†–ï–ü–Ø–¢–°–¢–í–ò–Ø ===== */
.obstacle {
    position: absolute;
    width: 64px;
    height: 110px;
    top: -140px;
    background: linear-gradient(180deg, #ffd740, #ff6f00);
    border-radius: 18px;
    box-shadow:
        0 15px 30px rgba(0,0,0,.7),
        inset 0 0 10px rgba(255,255,255,.3);
}

/* ===== HUD ===== */
#hud {
    position: absolute;
    top: 14px;
    left: 14px;
    color: #fff;
    font-size: 18px;
    line-height: 1.4;
    text-shadow: 0 2px 6px rgba(0,0,0,.8);
}

/* ===== –ú–ï–ù–Æ ===== */
#menu {
    position: absolute;
    inset: 0;
    background: linear-gradient(
        180deg,
        rgba(0,0,0,.55),
        rgba(0,0,0,.9)
    );
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    color: #fff;
    gap: 20px;
}

#menu h1 {
    margin: 0;
    font-size: 32px;
    letter-spacing: 1px;
}

button {
    padding: 16px 56px;
    font-size: 22px;
    border-radius: 40px;
    border: none;
    background: linear-gradient(180deg, #00e676, #00c853);
    color: #000;
    box-shadow: 0 10px 30px rgba(0,0,0,.65);
}
</style>
</head>

<body>
<div id="game">
    <div id="road"></div>
    <div id="car"></div>

    <div id="hud">
        –û—á–∫–∏: <span id="score">0</span><br>
        –†–µ–∫–æ—Ä–¥: <span id="best">0</span>
    </div>

    <div id="menu">
        <h1>üöó CAR RUSH</h1>
        <button id="start">–°–¢–ê–†–¢</button>
    </div>
</div>

<script>
const car = document.getElementById("car");
const road = document.getElementById("road");
const scoreEl = document.getElementById("score");
const bestEl = document.getElementById("best");
const menu = document.getElementById("menu");
const startBtn = document.getElementById("start");

let carX = 50;
let speed = 1.9;      // üëà –ª–µ–≥—á–µ
let score = 0;
let playing = false;
let obstacles = [];

bestEl.textContent = localStorage.getItem("best") || 0;

/* ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï (–¢–ê–ß) ===== */
document.addEventListener("pointerdown", e => {
    if (!playing) return;

    if (e.clientX < window.innerWidth / 2) {
        carX -= 9;
    } else {
        carX += 9;
    }

    carX = Math.max(20, Math.min(80, carX));
    car.style.left = carX + "%";
});

/* ===== –ü–†–ï–ü–Ø–¢–°–¢–í–ò–Ø ===== */
function spawnObstacle() {
    const o = document.createElement("div");
    o.className = "obstacle";
    o.style.left = (20 + Math.random() * 60) + "%";
    road.appendChild(o);
    obstacles.push(o);
}

/* ===== –ò–ì–†–û–í–û–ô –¶–ò–ö–õ ===== */
function loop() {
    if (!playing) return;

    score++;
    scoreEl.textContent = score;

    if (score % 400 === 0 && speed < 4) speed += 0.25; // –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç
    if (Math.random() < 0.018) spawnObstacle();       // —Ä–µ–¥–∫–æ

    obstacles.forEach((o, i) => {
        o.style.top = o.offsetTop + speed + "px";

        if (o.offsetTop > window.innerHeight) {
            o.remove();
            obstacles.splice(i, 1);
        }

        if (hit(car, o)) gameOver();
    });

    requestAnimationFrame(loop);
}

/* ===== –°–¢–û–õ–ö–ù–û–í–ï–ù–ò–ï ===== */
function hit(a, b) {
    const r1 = a.getBoundingClientRect();
    const r2 = b.getBoundingClientRect();
    return !(
        r1.right < r2.left ||
        r1.left > r2.right ||
        r1.bottom < r2.top ||
        r1.top > r2.bottom
    );
}

/* ===== –°–¢–ê–†–¢ / –ö–û–ù–ï–¶ ===== */
function startGame() {
    score = 0;
    speed = 1.9;
    obstacles.forEach(o => o.remove());
    obstacles = [];
    scoreEl.textContent = "0";
    menu.style.display = "none";
    playing = true;
    loop();
}

function gameOver() {
    playing = false;

    const best = Math.max(score, bestEl.textContent);
    localStorage.setItem("best", best);
    bestEl.textContent = best;

    menu.style.display = "flex";
}

startBtn.onclick = startGame;
</script>
</body>
</html>
