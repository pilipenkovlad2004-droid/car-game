<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Market Rush Drive</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    background: #0b0b0b;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, Arial;
}

/* ===== GAME ===== */
#game {
    width: 100vw;
    height: 100vh;
    position: relative;
}

/* ===== ROAD ===== */
#road {
    width: 72vw;
    max-width: 420px;
    height: 100vh;
    margin: auto;
    background: linear-gradient(#3b3b3b, #1e1e1e);
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 60px rgba(0,0,0,.9);
}

/* ===== LINES ===== */
.line {
    position: absolute;
    width: 10px;
    height: 70px;
    background: linear-gradient(#fff, #ccc);
    left: 50%;
    transform: translateX(-50%);
    border-radius: 6px;
    opacity: .85;
}

/* ===== CAR ===== */
#car {
    width: 62px;
    height: 112px;
    position: absolute;
    bottom: 24px;
    background: linear-gradient(#ff4d4d, #b00000);
    border-radius: 16px;
    box-shadow: 0 14px 40px rgba(0,0,0,.7);
}

#car::before {
    content: "";
    position: absolute;
    top: 8px;
    left: 8px;
    right: 8px;
    height: 20px;
    background: rgba(255,255,255,.25);
    border-radius: 12px;
}

/* ===== ENEMY ===== */
.enemy {
    width: 62px;
    height: 112px;
    position: absolute;
    top: -140px;
    background: linear-gradient(#777, #444);
    border-radius: 16px;
    box-shadow: 0 14px 40px rgba(0,0,0,.7);
}

/* ===== HUD ===== */
#hud {
    position: absolute;
    top: 14px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,.55);
    color: #fff;
    padding: 6px 16px;
    border-radius: 20px;
    font-size: 20px;
}

/* ===== OVERLAYS ===== */
.overlay {
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,.75);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    z-index: 10;
}

.panel {
    background: #1c1c1c;
    padding: 26px;
    border-radius: 20px;
    text-align: center;
    width: 80%;
    max-width: 320px;
    box-shadow: 0 0 40px rgba(0,0,0,.9);
}

.panel h1 {
    margin: 0 0 12px;
    font-size: 26px;
}

.btn {
    margin-top: 18px;
    padding: 12px;
    background: #ff4d4d;
    border-radius: 14px;
    cursor: pointer;
    font-size: 18px;
}
</style>
</head>

<body>
<div id="game">
    <div id="road">
        <div id="hud">0</div>
        <div id="car"></div>
    </div>

    <!-- START -->
    <div class="overlay" id="start">
        <div class="panel">
            <h1>üöó Market Rush Drive</h1>
            <div>–¢–∞–ø–∞–π —Å–ª–µ–≤–∞ / —Å–ø—Ä–∞–≤–∞<br>–£–∫–ª–æ–Ω—è–π—Å—è –æ—Ç –º–∞—à–∏–Ω</div>
            <div class="btn" onclick="startGame()">–ù–∞—á–∞—Ç—å</div>
        </div>
    </div>

    <!-- GAME OVER -->
    <div class="overlay" id="over" style="display:none">
        <div class="panel">
            <h1>üí• –ê–≤–∞—Ä–∏—è</h1>
            <div id="final"></div>
            <div class="btn" onclick="restart()">–ò–≥—Ä–∞—Ç—å –µ—â—ë</div>
        </div>
    </div>
</div>

<script>
const road = document.getElementById("road");
const car = document.getElementById("car");
const hud = document.getElementById("hud");
const startScreen = document.getElementById("start");
const overScreen = document.getElementById("over");
const finalText = document.getElementById("final");

let lanes = [];
let lane = 1;
let speed = 4;
let score = 0;
let enemies = [];
let lines = [];
let running = false;

/* ===== LANES ===== */
function setupLanes() {
    const w = road.offsetWidth;
    lanes = [w*0.2-31, w*0.5-31, w*0.8-31];
    car.style.left = lanes[lane] + "px";
}
window.addEventListener("resize", setupLanes);
setupLanes();

/* ===== LINES ===== */
for (let i=0;i<14;i++) {
    let l = document.createElement("div");
    l.className = "line";
    l.style.top = i*90 + "px";
    road.appendChild(l);
    lines.push(l);
}

/* ===== CONTROL ===== */
document.addEventListener("click", e => {
    if (!running) return;
    if (e.clientX < window.innerWidth/2 && lane>0) lane--;
    if (e.clientX >= window.innerWidth/2 && lane<2) lane++;
    car.style.left = lanes[lane] + "px";
});

/* ===== ENEMY ===== */
function spawnEnemy() {
    let e = document.createElement("div");
    e.className = "enemy";
    let l = Math.floor(Math.random()*3);
    e.style.left = lanes[l] + "px";
    road.appendChild(e);
    enemies.push({el:e,lane:l});
}

/* ===== LOOP ===== */
function loop() {
    if (!running) return;

    score++;
    hud.textContent = "–û—á–∫–∏: " + score;

    if (score % 300 === 0) speed += 0.5;
    if (Math.random() < 0.025) spawnEnemy();

    lines.forEach(l => {
        l.style.top = l.offsetTop + speed + "px";
        if (l.offsetTop > window.innerHeight) l.style.top = "-80px";
    });

    enemies.forEach((o,i) => {
        o.el.style.top = o.el.offsetTop + speed + "px";
        if (o.el.offsetTop > window.innerHeight) {
            o.el.remove();
            enemies.splice(i,1);
        }
        if (o.lane === lane && o.el.offsetTop > window.innerHeight-160) {
            endGame();
        }
    });

    requestAnimationFrame(loop);
}

/* ===== GAME FLOW ===== */
function startGame() {
    startScreen.style.display = "none";
    running = true;
    loop();
}

function endGame() {
    running = false;
    let best = Math.max(score, localStorage.getItem("best")||0);
    localStorage.setItem("best", best);

    finalText.innerHTML =
        `–û—á–∫–∏: <b>${score}</b><br>–†–µ–∫–æ—Ä–¥: <b>${best}</b>`;

    if (window.Telegram?.WebApp) {
        Telegram.WebApp.sendData(JSON.stringify({score, best}));
    }

    overScreen.style.display = "flex";
}

function restart() {
    location.reload();
}
</script>
</body>
</html>
